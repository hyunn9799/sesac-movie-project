<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MovieHub - 인증</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      * { box-sizing: border-box; }
      body { margin: 0; padding: 0; background-color: #141414; color: #fff; font-family: Arial, sans-serif; }
      a { cursor: pointer; }
      button { cursor: pointer; }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;

      // 스타일 토큰
      const colors = {
        primary: "#E50914", secondary: "#B20710", dark: "#141414", darkGray: "#2F2F2F",
        mediumGray: "#808080", lightGray: "#E5E5E5", white: "#FFFFFF", yellow: "#F5C518",
        success: "#4CAF50", warning: "#FF9800", error: "#F44336", info: "#2196F3",
        textLight: "#999999"
      };
      const spacing = { xs: "4px", sm: "8px", md: "16px", lg: "24px", xl: "32px" };
      const fontSize = { small: "12px", medium: "14px", large: "16px", xlarge: "20px", xxlarge: "24px", title: "32px" };
      const fontWeight = { normal: 400, bold: 700 };
      const borderRadius = { small: "4px", medium: "8px" };

      // 장르 목록
      const movieGenres = [
        '액션','키즈','모험','로맨스','공포','가족',
        '스릴러','다큐멘터리','애니메이션','범죄',
        'TV드라마','단편','드라마','판타지','SF','코미디'
      ];

      // 모달
      function Modal({ modal, closeModal }) {
        if (!modal.isVisible) return null;
        let icon="";
        if (modal.type==="success") icon="✔";
        if (modal.type==="error") icon="❗";
        return (
          <div style={{
            position:"fixed",top:0,left:0,right:0,bottom:0,
            background:"rgba(0,0,0,0.7)",display:"flex",
            justifyContent:"center",alignItems:"center",zIndex:1000
          }}>
            <div style={{
              background:colors.darkGray,padding:spacing.lg,
              borderRadius:borderRadius.medium,width:350,textAlign:"center"
            }}>
              <div style={{
                fontSize:fontSize.xxlarge,marginBottom:spacing.md,
                color: modal.type==="success"?colors.success:colors.error
              }}>{icon}</div>
              <p style={{whiteSpace:"pre-wrap",fontSize:fontSize.large}}>{modal.message}</p>
              <button onClick={closeModal} style={{
                marginTop:spacing.md,padding:`${spacing.sm} ${spacing.lg}`,
                background: modal.type==="success"?colors.success:colors.error,
                color:colors.white,border:"none",borderRadius:borderRadius.small
              }}>확인</button>
            </div>
          </div>
        );
      }

      // 확인 모달
      function ConfirmModal({ modal, onConfirm, onCancel }) {
        if (!modal.isVisible) return null;
        return (
          <div style={{
            position:"fixed",top:0,left:0,right:0,bottom:0,
            background:"rgba(0,0,0,0.7)",display:"flex",
            justifyContent:"center",alignItems:"center",zIndex:1000
          }}>
            <div style={{
              background:colors.white,padding:spacing.lg,
              borderRadius:borderRadius.medium,width:350,textAlign:"center",color:"#000"
            }}>
              <p style={{margin:0,fontSize:fontSize.xlarge}}>{modal.message}</p>
              <div style={{marginTop:spacing.md,display:"flex",justifyContent:"center",gap:spacing.md}}>
                <button onClick={onConfirm} style={{
                  background:colors.error,color:colors.white,border:"none",
                  padding:`${spacing.md} ${spacing.lg}`,borderRadius:borderRadius.small
                }}>예</button>
                <button onClick={onCancel} style={{
                  background:colors.mediumGray,color:colors.white,border:"none",
                  padding:`${spacing.md} ${spacing.lg}`,borderRadius:borderRadius.small
                }}>아니오</button>
              </div>
            </div>
          </div>
        );
      }

      // 로그인 폼
      function LoginForm({ onLoginSuccess, onNavigateRegister }) {
        const [id,setId]=useState(""),[pw,setPw]=useState(""),[err,setErr]=useState("");
        const submit=e=>{e.preventDefault();setErr("");
          if(!id||!pw){setErr("아이디와 비밀번호를 모두 입력해주세요.");return;}
          if(id==="test"&&pw==="1234"){onLoginSuccess(id);}else setErr("비밀번호가 잘못되었습니다.");
        };
        return (
          <div>
            <h2 style={{textAlign:"center",marginBottom:spacing.lg,fontSize:fontSize.title}}>로그인</h2>
            {err&&(
              <div style={{
                background:colors.error,color:colors.white,padding:spacing.md,
                borderRadius:borderRadius.small,marginBottom:spacing.lg,textAlign:"center"
              }}>❗ {err}</div>
            )}
            <form onSubmit={submit}>
              <label>아이디</label>
              <input style={{
                width:"100%",padding:spacing.md,margin:"8px 0",borderRadius:borderRadius.small,
                background:colors.darkGray,border:`1px solid ${colors.mediumGray}`,color:colors.white
              }} value={id} onChange={e=>setId(e.target.value)} />
              <label>비밀번호</label>
              <input type="password" style={{
                width:"100%",padding:spacing.md,margin:"8px 0",borderRadius:borderRadius.small,
                background:colors.darkGray,border:`1px solid ${colors.mediumGray}`,color:colors.white
              }} value={pw} onChange={e=>setPw(e.target.value)} />
              <button type="submit" style={{
                width:"100%",padding:spacing.md,background:colors.primary,
                color:colors.white,border:"none",borderRadius:borderRadius.small
              }}>로그인</button>
            </form>
            <div style={{textAlign:"center",marginTop:spacing.lg}}>
              <a onClick={onNavigateRegister} style={{color:colors.mediumGray}}>회원가입</a>
            </div>
          </div>
        );
      }

      // 회원가입 폼
      function RegisterForm({ onRegisterSuccess, onNavigateLogin }) {
        const [step,setStep]=useState(1);
        const [terms,setTerms]=useState({t1:false,t2:false,t3:false});
        const [all,setAll]=useState(false);
        const [data,setData]=useState({id:"",pw:"",name:"",email:"",liked:[],disliked:[]});
        const [err,setErr]=useState("");
        useEffect(()=>setAll(terms.t1&&terms.t2&&terms.t3),[terms]);
        const toggleTerm=n=>setTerms(p=>({...p,[n]:!p[n]}));
        const toggleLike=g=>setData(p=>{const liked=p.liked.includes(g)?p.liked.filter(x=>x!==g):[...p.liked,g];return{...p,liked,disliked:p.disliked.filter(x=>x!==g)}}); 
        const toggleDis=g=>setData(p=>{const disliked=p.disliked.includes(g)?p.disliked.filter(x=>x!==g):[...p.disliked,g];return{...p,disliked,liked:p.liked.filter(x=>x!==g)}}); 
        const next=e=>{
          if(!terms.t1||!terms.t2){setErr("필수 약관에 동의해야 진행됩니다.");return;} setErr(""); setStep(2);
        };
        const submit=e=>{
          e.preventDefault();setErr("");
          if(!data.id||!data.pw||!data.name||!data.email){setErr("모든 정보를 입력해주세요.");return;}
          if(data.liked.length===0){setErr("좋아하는 장르를 선택해주세요.");return;}
          onRegisterSuccess(data.id,data.liked,data.disliked);
        };
        return (
          <div>
            <h2 style={{textAlign:"center",marginBottom:spacing.lg,fontSize:fontSize.title}}>회원가입</h2>
            {step===1?(
              <>
                <div>
                  <label><input type="checkbox" checked={all} onChange={e=>setTerms({t1:e.target.checked,t2:e.target.checked,t3:e.target.checked})}/> 전체 동의</label>
                </div>
                {["t1","t2","t3"].map((k,i)=>(
                  <div key={k}>
                    <label>
                      <input type="checkbox" checked={terms[k]} onChange={()=>toggleTerm(k)}/>
                      {i<2?"(필수) ":"(선택) "}{i===0?"이용약관":i===1?"개인정보 수집":"마케팅"}
                    </label>
                  </div>
                ))}
                {err&&<div style={{color:colors.error,margin:spacing.md}}>{err}</div>}
                <button onClick={next} style={{marginRight:spacing.sm}}>다음</button>
                <button onClick={onNavigateLogin}>로그인</button>
              </>
            ):(
              <form onSubmit={submit}>
                <label>아이디</label><input style={{width:"100%",margin:"8px 0"}} name="id" onChange={e=>setData({...data,id:e.target.value})}/>
                <label>비밀번호</label><input type="password" style={{width:"100%",margin:"8px 0"}} name="pw" onChange={e=>setData({...data,pw:e.target.value})}/>
                <label>이름</label><input style={{width:"100%",margin:"8px 0"}} name="name" onChange={e=>setData({...data,name:e.target.value})}/>
                <label>이메일</label><input style={{width:"100%",margin:"8px 0"}} name="email" onChange={e=>setData({...data,email:e.target.value})}/>
                <p>좋아하는 영화 장르는? ❤️</p>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:spacing.sm}}>
                  {movieGenres.map(g=>(
                    <label key={g} style={{
                      background:data.liked.includes(g)?colors.primary:colors.darkGray,padding:"8px",borderRadius:"4px"
                    }}>
                      <input type="checkbox" checked={data.liked.includes(g)} onChange={()=>toggleLike(g)}/> {g}
                    </label>
                  ))}
                </div>
                <p>싫어하는 영화 장르는? 💔</p>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:spacing.sm}}>
                  {movieGenres.map(g=>(
                    <label key={g} style={{
                      background:data.disliked.includes(g)?colors.error:colors.darkGray,padding:"8px",borderRadius:"4px"
                    }}>
                      <input type="checkbox" checked={data.disliked.includes(g)} onChange={()=>toggleDis(g)}/> {g}
                    </label>
                  ))}
                </div>
                {err&&<div style={{color:colors.error,margin:spacing.md}}>{err}</div>}
                <button type="submit" style={{marginRight:spacing.sm}}>가입완료</button>
                <button type="button" onClick={()=>setStep(1)}>이전</button>
              </form>
            )}
          </div>
        );
      }

      // 메인 페이지
      function MainPage({ username,onLogoutConfirm,onWithdrawConfirm }) {
        return (
          <div style={{textAlign:"center",padding:spacing.lg}}>
            <h2 style={{fontSize:fontSize.xxlarge,marginBottom:spacing.lg}}>{username}님, 환영합니다!</h2>
            <button onClick={onLogoutConfirm} style={{marginRight:spacing.sm,padding:spacing.md,background:colors.warning,border:"none",borderRadius:borderRadius.small,color:colors.white}}>로그아웃</button>
            <button onClick={onWithdrawConfirm} style={{padding:spacing.md,background:colors.error,border:"none",borderRadius:borderRadius.small,color:colors.white}}>회원탈퇴</button>
          </div>
        );
      }

      // 로그아웃 성공 페이지
      function LogoutSuccess({ onBack }) {
        return (
          <div style={{textAlign:"center",padding:spacing.lg}}>
            <div style={{background:colors.success,padding:spacing.lg,borderRadius:borderRadius.small,marginBottom:spacing.lg}}>
              <p style={{fontSize:fontSize.xlarge,margin:0}}>✔ 로그아웃에 성공하였습니다!</p>
            </div>
            <button onClick={onBack} style={{padding:spacing.md,background:colors.primary,border:"none",borderRadius:borderRadius.small,color:colors.white}}>로그인 페이지로 이동</button>
          </div>
        );
      }

      // 회원탈퇴 성공 페이지
      function WithdrawSuccess({ onBack }) {
        return (
          <div style={{textAlign:"center",padding:spacing.lg}}>
            <div style={{background:colors.success,padding:spacing.lg,borderRadius:borderRadius.small,marginBottom:spacing.lg}}>
              <p style={{fontSize:fontSize.xlarge,margin:0}}>✔ 회원탈퇴가 완료되었습니다!</p>
            </div>
            <button onClick={onBack} style={{padding:spacing.md,background:colors.primary,border:"none",borderRadius:borderRadius.small,color:colors.white}}>로그인 페이지로 이동</button>
          </div>
        );
      }

      // App
      function AuthPage() {
        const [page,setPage]=useState("login");
        const [user,setUser]=useState("");
        const [modal,setModal]=useState({isVisible:false,type:"",message:""});
        const [confirm,setConfirm]=useState({isVisible:false,action:"",message:""});

        const openModal=(t,m)=>setModal({isVisible:true,type:t,message:m});
        const closeModal=()=>setModal({isVisible:false,type:"",message:""});

        const openConfirm=(a,m)=>setConfirm({isVisible:true,action:a,message:m});
        const closeConfirm=()=>setConfirm({isVisible:false,action:"",message:""});

        const loginSuccess=id=>{
          setUser(id); setPage("main");
        };
        const registerSuccess=(id,liked,disliked)=>{
          let msg=`회원가입에 성공했습니다!\n아이디: ${id}`;
          if(liked.length) msg+=`\n❤️ ${liked.join(",")}`;
          if(disliked.length) msg+=`\n💔 ${disliked.join(",")}`;
          openModal("success",msg);
          setTimeout(()=>{
            closeModal(); setPage("login");
          },3500);
        };

        const confirmLogout=()=>{
          openConfirm("logout","로그아웃 하시겠습니까?");
        };
        const doLogout=()=>{
          closeConfirm(); setPage("logoutSuccess");
        };

        const confirmWithdraw=()=>{
          openConfirm("withdraw","회원탈퇴 하시겠습니까?");
        };
        const doWithdraw=()=>{
          closeConfirm(); setPage("withdrawSuccess");
        };

        const handleConfirm=()=>{
          if(confirm.action==="logout") doLogout();
          if(confirm.action==="withdraw") doWithdraw();
        };

        return (
          <div style={{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"}}>
            <div style={{width:400,background:colors.darkGray,padding:spacing.lg,borderRadius:borderRadius.medium}}>
              {page==="login"&&<LoginForm onLoginSuccess={loginSuccess} onNavigateRegister={()=>setPage("register")}/>}
              {page==="register"&&<RegisterForm onRegisterSuccess={registerSuccess} onNavigateLogin={()=>setPage("login")}/>}
              {page==="main"&&<MainPage username={user} onLogoutConfirm={confirmLogout} onWithdrawConfirm={confirmWithdraw}/>}
              {page==="logoutSuccess"&&<LogoutSuccess onBack={()=>setPage("login")}/>}
              {page==="withdrawSuccess"&&<WithdrawSuccess onBack={()=>setPage("login")}/>}
            </div>
            <Modal modal={modal} closeModal={closeModal}/>
            <ConfirmModal modal={confirm} onConfirm={handleConfirm} onCancel={closeConfirm}/>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<AuthPage/>);
    </script>
  </body>
</html>
