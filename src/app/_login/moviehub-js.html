<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MovieHub - 인증 및 상태 페이지 (Vanilla JS - 최종 해결)</title>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; padding: 0; font-family: "Arial", sans-serif; }
        a { cursor: pointer; text-decoration: none; }
        #background-blur {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 0;
            background: url('https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNTA0MjJfMjgg%2FMDAxNzQ1MjQ5NTI0OTEx.oxs6IPzSZoyp7y7_JFJ5FCt0hL31OxVPhgnO5D5WaVgg.RYofXxz-Z_iMf_55kkWkfTmzvfHPUTgXJRAhUwR4e1sg.JPEG%2FKakaoTalk_20250422_002127317_08.jpg&type=sc960_832') center center / cover no-repeat;
            filter: blur(5px) brightness(0.5); opacity: 1;
        }
        /* UI 오버레이 */
        #root { position: relative; z-index: 1; min-height: 100vh; }
        /* 모바일 대응 */
        @media (max-width: 700px) {
            #background-blur { filter: blur(12px) brightness(0.55); }
        }
        /* 모달 카운트다운 텍스트 스타일 */
        .countdown-text { font-size: 10px; color: #ddd; margin-top: 8px; display: block; }
    </style>
</head>
<body>
    <div id="background-blur"></div>
    <div id="root"></div>

    <script>

        //  상태 관리 및 유틸리티 
        

        let state = {
            isLoggedIn: false,
            page: "login",
            username: "",
            modal: { isVisible: false, type: "", message: "" },
            confirmModal: { isVisible: false, message: "", action: "", confirmText: '확인', cancelText: '취소' },
            loginForm: { id: "", password: "", formError: "" },
            registerForm: { 
                step: 1, 
                // 약관 동의 상태를 명확히 구분하여 다시 설정
                terms: { term1: false, term2: false, term3: false },
                formData: { password: "", confirm: "", name: "", email: "", phone: "", liked: [], disliked: [] },
                formError: ""
            },
            _modalTimer: null,
            _modalCountdownInterval: null,
            _modalOpenTime: null
        };

        const rootElement = document.getElementById("root");
        
        // 상태 업데이트 및 UI 리렌더링 함수
        function setState(newState, shouldRender = true) {
            const nextState = { ...state };

            if (newState.loginForm) { nextState.loginForm = { ...nextState.loginForm, ...newState.loginForm }; }
            if (newState.registerForm) {
                nextState.registerForm = { ...nextState.registerForm, ...newState.registerForm };
                if (newState.registerForm.formData) { nextState.registerForm.formData = { ...nextState.registerForm.formData, ...newState.registerForm.formData }; }
                if (newState.registerForm.terms) { nextState.registerForm.terms = { ...nextState.registerForm.terms, ...newState.registerForm.terms }; }
            }
            
            for (const key in newState) {
                if (key !== 'loginForm' && key !== 'registerForm') { nextState[key] = newState[key]; }
            }
            
            state = nextState;
            if (shouldRender) renderApp();
        }

        // DOM 요소 생성 헬퍼 함수
        function createElement(tag, attributes = {}, styles = {}, children = []) {
            const element = document.createElement(tag);
            Object.keys(attributes).forEach(key => {
                if (key.startsWith('on')) { 
                    element[key.toLowerCase()] = attributes[key]; 
                } else if (key === 'value' || key === 'checked' || key === 'placeholder' || key === 'name' || key === 'type') {
                    element[key] = attributes[key]; 
                } else { 
                    element.setAttribute(key, attributes[key]); 
                }
            });
            Object.keys(styles).forEach(key => { element.style[key] = styles[key]; });
            children.forEach(child => {
                if (typeof child === 'string') { element.appendChild(document.createTextNode(child)); } 
                else if (child instanceof Node) { element.appendChild(child); }
            });
            return element;
        }

        // 스타일 토큰 
        const colors = { primary:"#E50914", secondary:"#B20710", dark:"#141414", darkGray:"#2F2F2F", mediumGray:"#808080", lightGray:"#E5E5E5", white:"#FFFFFF", yellow:"#F5C518", success:"#4CAF50", warning:"#FF9800", error:"#F44336", info:"#2196F3", textPrimary:"#FFFFFF", textSecondary:"#808080", textLight:"#999999", };
        const spacing = { xs:"4px", sm:"8px", md:"16px", lg:"24px", xl:"32px", xxl:"48px" };
        const fontSize = { small:"12px", medium:"14px", large:"16px", xlarge:"20px", xxlarge:"24px", title:"32px" };
        const fontWeight = { normal:400, bold:700 };
        const borderRadius = { small:"4px", medium:"8px", large:"12px" };
        const shadow = { header:'0 2px 8px rgba(0,0,0,0.3)' };
        const movieGenres = ['액션','키즈','모험','로맨스','공포','가족','스릴러','다큐멘터리','애니메이션','범죄','TV드라마','단편','드라마','판타지','SF','코미디'];
        const getButtonStyle = (bg,color) => ({ backgroundColor:bg, color:color, padding:`${spacing.sm} ${spacing.lg}`, border:"none", borderRadius:borderRadius.small, cursor:"pointer", fontSize:fontSize.medium, fontWeight:fontWeight.bold });

       
        // 모달 및 알림 함수
        
        function cleanupModalTimers() {
            if (state._modalTimer) clearTimeout(state._modalTimer);
            if (state._modalCountdownInterval) clearInterval(state._modalCountdownInterval);
            state._modalTimer = null;
            state._modalCountdownInterval = null;
            state._modalOpenTime = null;
        }

        function openModal(type, message) {
            cleanupModalTimers();
            setState({ modal: { isVisible: true, type, message }, _modalOpenTime: Date.now() });
            
            state._modalTimer = setTimeout(closeModal, 2000);
            state._modalCountdownInterval = setInterval(renderApp, 1000);
        }

        function closeModal() {
            cleanupModalTimers();
            if (state.modal.type === "success" && state.page === "register") {
                setState({ page: "login" });
            }
            setState({ modal: { isVisible: false, type: "", message: "" } });
        }
        
        function renderModal() {
            const { modal } = state;
            if (!modal.isVisible) return null;

            const remainingTime = Math.max(0, Math.ceil((2000 - (Date.now() - (state._modalOpenTime || Date.now()))) / 1000));
            
            const handleClose = () => { cleanupModalTimers(); closeModal(); };
            
            let headerText = "", headerColor = "";
            if (modal.type === "success") { headerText = "✔"; headerColor = colors.success; }
            else if (modal.type === "error") { headerText = "❗"; headerColor = colors.error; }
            else if (modal.type === "warning") { headerText = "⚠"; headerColor = colors.warning; }

            const modalOverlay = createElement('div', {}, { position: "fixed", top: 0, left: 0, right: 0, bottom: 0, backgroundColor: "rgba(0,0,0,0.7)", display: "flex", justifyContent: "center", alignItems: "center", zIndex: 1000 });
            const modalContent = createElement('div', {}, { backgroundColor: colors.darkGray, padding: spacing.xl, borderRadius: borderRadius.medium, width: "350px", textAlign: "center", color: colors.white }, [
                createElement('div', {}, { fontSize: fontSize.xxlarge, marginBottom: spacing.md, fontWeight: fontWeight.bold, color: headerColor }, [headerText]),
                createElement('p', {}, { whiteSpace: "pre-wrap", margin: 0, fontSize: fontSize.large, lineHeight: 1.6 }, [modal.message]),
                createElement('button', { onclick: handleClose }, getButtonStyle(headerColor, colors.white), ["확인"]),
                createElement('span', { className: "countdown-text" }, {}, [`${remainingTime}초 후 자동 확인됩니다.`])
            ]);
            
            modalOverlay.appendChild(modalContent);
            return modalOverlay;
        }

        function renderConfirmModal() {
            const { confirmModal } = state;
            if (!confirmModal.isVisible) return null;

            const handleConfirm = () => { if (confirmModal.action === "logout") confirmLogout(); };
            const handleCancel = () => setState({ confirmModal: { isVisible: false, message: "", action: "" } });

            const modalOverlay = createElement('div', {}, { position: "fixed", top: 0, left: 0, right: 0, bottom: 0, backgroundColor: "rgba(0,0,0,0.7)", display: "flex", justifyContent: "center", alignItems: "center", zIndex: 1000 });
            const buttonGroup = createElement('div', {}, { display: "flex", gap: spacing.md, justifyContent: "center" }, [
                createElement('button', { onclick: handleConfirm }, getButtonStyle(colors.primary, colors.white), [confirmModal.confirmText || '확인']),
                createElement('button', { onclick: handleCancel }, getButtonStyle(colors.mediumGray, colors.white), [confirmModal.cancelText || '취소'])
            ]);
            const modalContent = createElement('div', {}, { backgroundColor: colors.darkGray, padding: spacing.xl, borderRadius: borderRadius.medium, width: "300px", textAlign: "center", color: colors.white }, [
                createElement('p', {}, { margin: 0, fontSize: fontSize.xlarge, marginBottom: spacing.lg, fontWeight: fontWeight.bold }, [confirmModal.message]),
                buttonGroup
            ]);

            modalOverlay.appendChild(modalContent);
            return modalOverlay;
        }

        // 컴포넌트 렌더링 함수

        function renderHeader() {
            const { isLoggedIn } = state;
            const attemptLogout = () => setState({ confirmModal: { isVisible: true, message: "로그아웃 하시겠습니까?", action: "logout" } });

            const headerStyle={ backgroundColor:colors.dark, padding:`${spacing.md} ${spacing.xl}`, display:'flex', justifyContent:'space-between', alignItems:'center', boxShadow:shadow.header, position:'fixed', top:0,left:0,right:0,zIndex:999 };
            const logoStyle={ fontSize:fontSize.xxlarge, color:colors.primary, fontWeight:fontWeight.bold, margin:0 };
            const searchInputStyle={ padding:spacing.sm, borderRadius:borderRadius.small, border:`1px solid ${colors.mediumGray}`, backgroundColor:colors.darkGray, color:colors.white, width:'250px', fontSize:fontSize.medium };

            const searchInput = createElement('input', { type: "text", placeholder: "영화, 감독, 배우 검색..." }, searchInputStyle);

            const actionButtons = [];
            if (isLoggedIn) {
                actionButtons.push(createElement('button', {}, getButtonStyle(colors.darkGray, colors.white), ["마이페이지"]));
                actionButtons.push(createElement('button', { onclick: attemptLogout }, getButtonStyle(colors.primary, colors.white), ["로그아웃"]));
            } else {
                actionButtons.push(createElement('button', { onclick: () => setState({ page: "login" }) }, getButtonStyle(colors.primary, colors.white), ["로그인"]));
                actionButtons.push(createElement('button', { onclick: () => setState({ page: "register" }) }, getButtonStyle(colors.darkGray, colors.white), ["회원가입"]));
            }

            const headerDiv = createElement('div', {}, headerStyle, [
                createElement('h1', {}, logoStyle, ["🎬 MovieHub"]),
                createElement('div', {}, { display: 'flex', alignItems: 'center', gap: spacing.md }, [searchInput, ...actionButtons])
            ]);

            return headerDiv;
        }

        function renderLoginForm() {
            const { id, password, formError } = state.loginForm;

            const updateField = (name, value) => {
                setState({ loginForm: { [name]: value } }, false); 
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                const currentId = state.loginForm.id;
                const currentPassword = state.loginForm.password;

                if (!currentId || !currentPassword) {
                    setState({ loginForm: { formError: "아이디와 비밀번호를 모두 입력해주세요." } });
                    return;
                }
                if (currentId === "team3" && currentPassword === "1234") {
                    handleLoginSuccess(currentId);
                } else if (currentId === "test") {
                    setState({ loginForm: { formError: "비밀번호가 잘못되었습니다. 아이디와 비밀번호를 정확히 입력해 주세요." } });
                } else {
                    setState({ loginForm: { formError: "아이디 또는 비밀번호가 일치하지 않습니다. 아이디와 비밀번호를 정확히 입력해 주세요." } });
                }
            };
            
            const inputStyle={width:"100%",backgroundColor:colors.darkGray,border:`1px solid ${colors.mediumGray}`, color:colors.white,padding:spacing.md,marginBottom:spacing.lg,marginTop:spacing.xs,borderRadius:borderRadius.small};
            const btnStyle={width:"100%",backgroundColor:colors.primary,color:colors.white,fontSize:fontSize.large,padding:spacing.md,border:"none",borderRadius:borderRadius.small,cursor:"pointer"};

            const form = createElement('form', { onsubmit: handleSubmit }, {}, [
                createElement('label', {}, {display:"block",fontSize:fontSize.medium,color:colors.textLight}, ["아이디"]),
                createElement('input', { name: "id", type: "text", value: id, oninput: (e) => updateField('id', e.target.value), placeholder: "아이디를 입력하세요." }, inputStyle),
                createElement('label', {}, {display:"block",fontSize:fontSize.medium,color:colors.textLight}, ["비밀번호"]),
                createElement('input', { name: "password", type: "password", value: password, oninput: (e) => updateField('password', e.target.value), placeholder: "비밀번호를 입력하세요." }, inputStyle),
                createElement('button', { type: "submit" }, btnStyle, ["로그인"])
            ]);

            const links = createElement('div', {}, {marginTop:spacing.xl,textAlign:"center"}, [
                createElement('a', { onclick: () => setState({ page: "register" }) }, 
                    {color:colors.mediumGray,textDecoration:"none",display:"block",marginBottom:spacing.sm}, ["회원가입"]),
                createElement('a', { href: "#" }, 
                    {color:colors.mediumGray,textDecoration:"none",display:"block"}, ["아이디 / 비밀번호 찾기"])
            ]);

            const errorDiv = formError ? createElement('div', {}, {backgroundColor:colors.error,color:colors.white,padding:spacing.lg,borderRadius:borderRadius.small,marginBottom:spacing.lg,textAlign:"center"}, [
                createElement('p', {}, {margin:0,fontSize:fontSize.large,fontWeight:fontWeight.bold}, [`❗ ${formError}`])
            ]) : document.createDocumentFragment();

            return createElement('div', {}, {}, [
                createElement('h2', {}, {textAlign:"center",color:colors.white,marginBottom:spacing.xl,fontSize:fontSize.title}, ["로그인"]),
                errorDiv,
                form,
                links
            ]);
        }

        function renderRegisterForm() {
            const { step, terms, formData, formError } = state.registerForm;
            const { liked, disliked } = formData;
            // terms의 모든 필수 항목이 true인지 확인
            const allChecked = terms.term1 && terms.term2 && terms.term3;

            const updateField = (name, value) => {
                setState({ registerForm: { formData: { ...formData, [name]: value } } }, false); // 입력 시 렌더링 X
            };

            const updateTerm = (name, checked) => {
                setState({ registerForm: { terms: { ...terms, [name]: checked } } });
            };

            const toggleAll = (e) => {
                const checked = e.target.checked;
                setState({ registerForm: { terms: { term1: checked, term2: checked, term3: checked } } });
            };

            const toggleGenre = (genre, type) => {
                const field = type === 'like' ? 'liked' : 'disliked';
                const list = formData[field].includes(genre)
                    ? formData[field].filter(g => g !== genre)
                    : [...formData[field], genre];
                setState({ registerForm: { formData: { ...formData, [field]: list } } });
            };

            const nextStep = () => {
                // 필수 약관 검사: term1, term2
                if (!terms.term1 || !terms.term2) {
                    setState({ registerForm: { formError: "필수 약관에 동의해야 다음 단계로 진행할 수 있습니다." } });
                    return;
                }
                setState({ registerForm: { formError: "", step: 2 } });
            };
            
            const submit = (e) => {
                e.preventDefault();
                if (formData.password !== formData.confirm) {
                    setState({ registerForm: { formError: "비밀번호와 비밀번호 확인이 일치하지 않습니다." } });
                    return;
                }
                if (liked.length === 0) {
                    setState({ registerForm: { formError: "좋아하는 영화 장르를 최소 1개 이상 선택해주세요." } });
                    return;
                }
                if (disliked.length === 0) {
                    setState({ registerForm: { formError: "싫어하는 영화 장르를 최소 1개 이상 선택해주세요." } });
                    return;
                }
                handleRegisterSuccess(formData.email);
            };

            const inputStyle={width:"100%",backgroundColor:colors.darkGray,border:`1px solid ${colors.mediumGray}`,color:colors.white,padding:spacing.md,marginBottom:spacing.lg,marginTop:spacing.xs,borderRadius:borderRadius.small};
            const pStyle={width:"100%",backgroundColor:colors.primary,color:colors.white,fontSize:fontSize.large,padding:spacing.md,marginBottom:spacing.md,border:"none",borderRadius:borderRadius.small,cursor:"pointer"};
            const sStyle={width:"100%",backgroundColor:colors.darkGray,border:`1px solid ${colors.mediumGray}`,color:colors.white,fontSize:fontSize.large,padding:spacing.md,borderRadius:borderRadius.small,cursor:"pointer"};
            const box={border:`1px solid ${colors.mediumGray}`,padding:spacing.md,borderRadius:borderRadius.small,marginBottom:spacing.sm,backgroundColor:colors.dark};
            const cb={marginRight:spacing.sm,width:"16px",height:"16px",cursor:"pointer"};
            
            const errorElement = formError ? createElement('p', {}, {color:colors.error,textAlign:"center",margin:`${spacing.md} 0`}, [formError]) : document.createDocumentFragment();

            let content;
            if (step === 1) {
                content = createElement('div', {}, {}, [
                    createElement('p', {}, {textAlign:"center",fontSize:fontSize.xlarge,marginBottom:spacing.md,color:colors.white}, ["약관 동의"]),
                    
                    // 전체 동의
                    createElement('div', {}, {marginBottom:spacing.lg,padding:spacing.md,backgroundColor:colors.darkGray,borderRadius:borderRadius.small}, [
                        createElement('label', {}, {display:"flex",alignItems:"center",fontWeight:fontWeight.bold,color:colors.white,cursor:"pointer"}, [
                            createElement('input', { type: "checkbox", checked: allChecked, onchange: toggleAll }, { ...cb, width: "18px", height: "18px" }),
                            createElement('span', {}, {}, ["전체 약관에 동의합니다."])
                        ])
                    ]),
                    
                    // 1. (필수) 이용 약관 동의
                    createElement('div', {}, box, [
                        createElement('label', {}, {display:"flex",alignItems:"center",color:colors.white,cursor:"pointer"}, [
                            createElement('input', { type: "checkbox", checked: terms.term1, onchange: (e) => updateTerm('term1', e.target.checked) }, cb),
                            createElement('span', {}, {}, ["(필수) 이용 약관 동의"])
                        ])
                    ]),

                    // 2. (필수) 개인정보 수집 및 이용 동의
                    createElement('div', {}, box, [
                        createElement('label', {}, {display:"flex",alignItems:"center",color:colors.white,cursor:"pointer"}, [
                            createElement('input', { type: "checkbox", checked: terms.term2, onchange: (e) => updateTerm('term2', e.target.checked) }, cb),
                            createElement('span', {}, {}, ["(필수) 개인정보 수집 및 이용 동의"])
                        ])
                    ]),
                    
                    // 3. (선택) 마케팅 정보 수신 동의
                    createElement('div', {}, box, [
                        createElement('label', {}, {display:"flex",alignItems:"center",color:colors.white,cursor:"pointer"}, [
                            createElement('input', { type: "checkbox", checked: terms.term3, onchange: (e) => updateTerm('term3', e.target.checked) }, cb),
                            createElement('span', {}, {}, ["(선택) 마케팅 정보 수신 동의"])
                        ])
                    ]),

                    errorElement,
                    createElement('button', { onclick: nextStep }, pStyle, ["다음 단계"]),
                    createElement('button', { onclick: () => setState({ page: "login" }) }, sStyle, ["로그인 페이지로 돌아가기"])
                ]);
            } else {
                content = createElement('form', { onsubmit: submit }, {}, [
                    createElement('p', {}, {textAlign:"center",fontSize:fontSize.xlarge,marginBottom:spacing.md,color:colors.white}, ["회원 정보 입력"]),
                    
                    createElement('label', {}, {display:"block",fontSize:fontSize.medium,color:colors.textLight}, ["이메일 *"]),
                    createElement('input', { name: "email", type: "email", value: formData.email, oninput: (e) => updateField('email', e.target.value), placeholder: "example@moviehub.com" }, inputStyle),
                    
                    createElement('label', {}, {display:"block",fontSize:fontSize.medium,color:colors.textLight}, ["비밀번호(4자 이상 입력하세요) *"]),
                    createElement('input', { name: "password", type: "password", value: formData.password, oninput: (e) => updateField('password', e.target.value) }, inputStyle),
                    
                    createElement('label', {}, {display:"block",fontSize:fontSize.medium,color:colors.textLight}, ["비밀번호 확인 (비밀번호를 다시 한번 확인해주세요)*"]),
                    createElement('input', { name: "confirm", type: "password", value: formData.confirm, oninput: (e) => updateField('confirm', e.target.value) }, inputStyle),
                    
                    createElement('label', {}, {display:"block",fontSize:fontSize.medium,color:colors.textLight}, ["이름 *"]),
                    createElement('input', { name: "name", type: "text", value: formData.name, oninput: (e) => updateField('name', e.target.value) }, inputStyle),
                    
                    createElement('label', {}, {display:"block",fontSize:fontSize.medium,color:colors.textLight}, ["전화번호 *"]),
                    createElement('input', { name: "phone", type: "tel", value: formData.phone, oninput: (e) => updateField('phone', e.target.value), placeholder: "010-0000-0000" }, inputStyle),
                    
                    createElement('label', {}, {display:"block",fontSize:fontSize.medium,color:colors.textLight,marginTop:spacing.md,marginBottom:spacing.sm}, ["좋아하는 영화 장르 (1개 이상 선택) *"]),
                    createElement('div', {}, {display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:spacing.sm,marginBottom:spacing.lg}, 
                        movieGenres.map(genre => 
                            createElement('label', {}, {display:"flex",alignItems:"center",color:colors.white,cursor:"pointer",backgroundColor:colors.darkGray,padding:spacing.sm,borderRadius:borderRadius.small}, [
                                createElement('input', { type: "checkbox", checked: liked.includes(genre), onchange: () => toggleGenre(genre, 'like') }, cb),
                                createElement('span', {}, {}, [genre])
                            ])
                        )
                    ),

                    createElement('label', {}, {display:"block",fontSize:fontSize.medium,color:colors.textLight,marginTop:spacing.md,marginBottom:spacing.sm}, ["싫어하는 영화 장르 (1개 이상 선택) *"]),
                    createElement('div', {}, {display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:spacing.sm,marginBottom:spacing.lg}, 
                        movieGenres.map(genre => 
                            createElement('label', {}, {display:"flex",alignItems:"center",color:colors.white,cursor:"pointer",backgroundColor:colors.darkGray,padding:spacing.sm,borderRadius:borderRadius.small}, [
                                createElement('input', { type: "checkbox", checked: disliked.includes(genre), onchange: () => toggleGenre(genre, 'disliked') }, cb),
                                createElement('span', {}, {}, [genre])
                            ])
                        )
                    ),
                    
                    errorElement,
                    createElement('button', { type: "submit" }, pStyle, ["회원가입 완료"]),
                    createElement('button', { type: "button", onclick: () => setState({ registerForm: { ...state.registerForm, step: 1 } }) }, sStyle, ["이전 단계"])
                ]);
            }

            return createElement('div', {}, {}, [
                createElement('h2', {}, {textAlign:"center",color:colors.white,marginBottom:spacing.xl,fontSize:fontSize.title}, ["회원가입"]),
                content
            ]);
        }

        function renderMainPage() {
            const { username } = state;
            const attemptLogout = () => setState({ confirmModal: { isVisible: true, message: "로그아웃 하시겠습니까?", action: "logout" } });

            return createElement('div', {}, {textAlign:"center",color:colors.white,paddingTop:spacing.xxl}, [
                createElement('div', {}, {backgroundColor:colors.darkGray,padding:spacing.xxl,borderRadius:borderRadius.medium,marginBottom:spacing.xl}, [
                    createElement('p', {}, {fontSize:fontSize.xlarge,margin:0,fontWeight:fontWeight.bold}, [`🎉🎬Moviehub에 오신 것을 환영합니다!🎉`])
                ]),
                createElement('button', { onclick: attemptLogout }, getButtonStyle(colors.primary, colors.white), ["로그아웃"])
            ]);
        }

        function renderLogoutSuccessPage() {
            return createElement('div', {}, {textAlign:"center",color:colors.white,paddingTop:spacing.xxl}, [
                createElement('div', {}, {backgroundColor:colors.success,padding:spacing.xxl,borderRadius:borderRadius.medium,marginBottom:spacing.xl}, [
                    createElement('p', {}, {fontSize:fontSize.xlarge,margin:0,fontWeight:fontWeight.bold,color:colors.white}, ["로그아웃에 성공하였습니다!"])
                ]),
                createElement('button', { onclick: () => setState({ page: "login" }) }, getButtonStyle(colors.primary, colors.white), ["로그인 페이지로 이동"])
            ]);
        }


    
        //  메인 앱 로직
      

        const handleLoginSuccess = (id) => {
            setState({ username: id, isLoggedIn: true, page: "main" });
            openModal("success", `김새싹님, 환영합니다!`);
        };

        const handleRegisterSuccess = (id) => {
            // 회원가입 성공 시 폼을 초기화하고 모달을 띄운 후, 모달이 닫히면 로그인 페이지로 이동
            setState({ 
                page: "register", 
                registerForm: { 
                    step: 1, 
                    terms: { term1: false, term2: false, term3: false },
                    formData: { password: "", confirm: "", name: "", email: "", phone: "", liked: [], disliked: [] },
                    formError: ""
                }
            });
            openModal("success", `환영합니다, 김새싹님! 회원가입에 성공했습니다!\ 로그인 페이지로 이동합니다.`);
        };

        const confirmLogout = () => {
            setState({ 
                confirmModal: { isVisible: false, message: "", action: "" }, 
                isLoggedIn: false, 
                username: "", 
                page: "logoutSuccess" 
            });
        };
        
    function renderAuthPage() {
            const { page } = state;
           
            const containerStyle = { minHeight:"100vh", backgroundColor: "rgba(0,0,0,0.7)", color:colors.white, display:"flex", justifyContent:"center", alignItems:"center", padding:spacing.xl, paddingTop:`calc(${spacing.xl}+60px)` };
            const boxStyle = { width:"100%", maxWidth:"450px", padding:spacing.xl, backgroundColor:colors.darkGray, borderRadius:borderRadius.medium, boxShadow:"0 8px 16px rgba(0,0,0,0.2)" };

            let contentElement;
            if (page === "login") contentElement = renderLoginForm();
            else if (page === "register") contentElement = renderRegisterForm();
            else if (page === "main") contentElement = renderMainPage();
            else if (page === "logoutSuccess") contentElement = renderLogoutSuccessPage();
            else contentElement = createElement('div', {}, {}, ['페이지를 찾을 수 없습니다.']);

            const box = createElement('div', {}, boxStyle, [contentElement]);
            const mainContainer = createElement('div', {}, containerStyle, [box]);

            const header = renderHeader();
            const modal = renderModal();
            const confirmModal = renderConfirmModal();

            const fragment = document.createDocumentFragment();
            fragment.appendChild(header);
            fragment.appendChild(mainContainer);
            if (modal) fragment.appendChild(modal);
            if (confirmModal) fragment.appendChild(confirmModal);

            return fragment;
        }
        // 앱 렌더링 함수
        function renderApp() {
            rootElement.innerHTML = '';
            rootElement.appendChild(renderAuthPage());
        }

        // 초기 실행: 페이지 로드 후 렌더링 시작
        document.addEventListener('DOMContentLoaded', renderApp);
    </script>
</body>
</html>